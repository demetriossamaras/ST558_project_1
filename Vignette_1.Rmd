---
title: "Vignette for reading and summarizing data from API's"
author: "Demetrios Samaras"
date: "2023-06-16"
output:
   html_document:
    toc: TRUE
    toc_depth: 3
    toc_float: FALSE
    code_folding: hide
    theme: readable
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE)

##polygon api key = DrI5M1TDWji8nJS9aZDfUAdR_6iqhFzm

##omdb api key = bf40992d

## pokemon api 
```

```{r render, include=FALSE, eval=FALSE}

rmarkdown::render(input = Vignette_1, output_format = github_document, output_file = "README.md", output_dir = top level folder? )


```


# Purpose 

##### The purpose of this Vignette is to summarize how to interact with, pull data and then analyze the data from the pokemon data API [https://pokeapi.co/](https://pokeapi.co/). 

# Required packages 

##### The following packages will be required 

  * **tidyverse**
    + We will use a number of the functions from the tidyverse
  * **jsonlite**
    + This will help up interact with the API
  * **httr**
    + for the `GET` function 
  * **ggplot2**
    + This will be required to create the data visualizations (comes in tidyverse)
    
# functions for querying endpoints  

### Step 0 

Make sure all of the required packages are installed using the `install.packages()` function and library them using `library()`

```{r library functions, echo=TRUE, eval=TRUE}

library(tidyverse)
library(jsonlite)
library(httr)
library(ggplot2)

```


## Contact the API 

This is the general format that we will use to contact the api and retrieve data    

```{r contact , echo = TRUE, eval = FALSE}
## this is a functin to contact the API from a url 
query <- function(x){
  ## will generate a url with the desired endpoint and inputed data 
  url<- x 
  
 ## contact the api  and store the response  
 response <-GET(x)
 ## converts raw to charecter  
 data <- rawToChar(response$content)
 ## converts from json data
 jsondata <- fromJSON(data)
 ## organizes results of interest in a tibble and prints 
 tibbleresults <- as_tibble(jsondata$ResultOfInterest)
 
 tibbleresults
 
}
  
```


## Interacting with the "pokemon" endpoints. 

#### `WhosThatPokemon` endpoint 1 

This function will return a list of Pokemon and their ID number. As of writing there are 1008 Pokemon so by default it will return a tibble containing the names of all Pokemon in order. If you only wanted to see the first n number of Pokemon you would set n equal to that number. For example n=151 will return only the first 151 Pokemon. If you have a specific Pokemon in mind you can give the name or ID as pokemon="name" or pokemon=ID which will return a vector of the information available about that specific pokemon. If you know the information that you want on that pokemon you can set info equal to the info of interest. For example if want the weight set info="weight". 

```{r pokemon endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

WhosThatPokemon <- function(pokemon="all", n=1008, info=NULL){
  ## if you want all Pokemon between 1 and your number of interest n
  if(pokemon=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/pokemon/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info on the specific Pokemon or ID number 
  if(pokemon!= "all"&is.null(info)){
 ## generates url containing pokemon name or id of interest   
 url <- paste0("https://pokeapi.co/api/v2/pokemon/", pokemon, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(pokemon!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/pokemon/", pokemon, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- jsondata[info]
  
 
  }
  data1
}


```

```{r }




```



## EDA analysis 

#### We are going to use the fuctions that we createed to get the heights and weights the pokemon and look at the relationship 

```{r heights weights types  }
## sets the tibble of first 10 pokemon as a global object 
test10<- WhosThatPokemon(n=10)


## contacts the api to get the heights for the first 10 pokemon
TenPokeHeights <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "height")

## converts the results to a tibble with the heights as the column
TenPokeHeights <- unlist(TenPokeHeights) %>% as_tibble()
names(TenPokeHeights) <- "height"


## contacts the api to get the weights for the first 10 pokemon
TenPokeWeights <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "weight")

## converts result to tibble with weights as the column
TenPokeWeights <- unlist(TenPokeWeights) %>% as_tibble()
names(TenPokeWeights) <- "weight"

## contacts the api to get the types for the first 10 pokemon 
TenPokeTypes <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "types")

TenPokeTypes <- sapply(1:10, FUN = function(i){TenPokeTypes[[i]][[2]][1,1]})

TenPokeTypes<- TenPokeTypes%>% as_tibble()

names(TenPokeTypes) <- "type"

## binds the column of heights and weights to the pokemon 
PokemonHeightsWeightsTypes <- cbind(test10, TenPokeHeights, TenPokeWeights, TenPokeTypes)

```

```{r heights vs weights scatter, echo=TRUE, eval=TRUE}

g <- ggplot(PokemonHeightsWeightsTypes, aes(x=height, y=weight))

g+geom_point(aes(color=type))



```








 













