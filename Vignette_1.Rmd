---
title: "Vignette for reading and summarizing data from API's"
author: "Demetrios Samaras"
date: "2023-06-16"
output:
   html_document:
    toc: TRUE
    toc_depth: 3
    toc_float: FALSE
    code_folding: hide
    theme: readable
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE)

```

```{r render, include=FALSE, eval=FALSE}

rmarkdown::render(input = Vignette_1, output_format = github_document, output_file = "README.md", output_dir = top level folder? )


```


# Purpose 

##### The purpose of this Vignette is to summarize how to interact with, pull data and then analyze the data from the pokemon data API [https://pokeapi.co/](https://pokeapi.co/). 

# Required packages 

##### The following packages will be required 

  * **tidyverse**
    + We will use a number of the functions from the tidyverse
  * **jsonlite**
    + This will help up interact with the API
  * **httr**
    + for the `GET` function 
  * **ggplot2**
    + This will be required to create the data visualizations (comes in tidyverse)
    
# functions for querying endpoints  

### Step 0 

Make sure all of the required packages are installed using the `install.packages()` function and library them using `library()`

```{r library functions, echo=TRUE, eval=TRUE}

library(tidyverse)
library(jsonlite)
library(httr)
library(ggplot2)

```


## Contact the API 

This is the general format that we will use to contact the api and retrieve data (One thing to note is that the Pokemon API does not require a key, many other API's will require you to use ypur specific key included at the end of the URL)    

```{r contact , echo = TRUE, eval = FALSE}
## this is a functin to contact the API from a url 
query <- function(x){
  ## will generate a url with the desired endpoint and inputed data 
  url<- x 
  
 ## contact the api  and store the response  
 response <-GET(x)
 ## converts raw to charecter  
 data <- rawToChar(response$content)
 ## converts from json data
 jsondata <- fromJSON(data)
 ## organizes results of interest in a tibble and prints 
 tibbleresults <- as_tibble(jsondata$ResultOfInterest)
 
 tibbleresults
 
}
  
```


## Interacting with the Pokemon API endpoints. 

### `WhosThatPokemon` endpoint 1 

This function will return a list of Pokemon and their ID number. As of writing there are 1008 Pokemon so by default it will return a tibble containing the names of all Pokemon in order. If you only wanted to see the first n number of Pokemon you would set n equal to that number. For example n=151 will return only the first 151 Pokemon. If you have a specific Pokemon in mind you can give the name or ID as pokemon="name" or pokemon=ID which will return a the information available about that specific pokemon. If you know the information that you want on that pokemon you can set info equal to the info of interest. For example if want the weight set info="weight". 

```{r pokemon endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

WhosThatPokemon <- function(pokemon="all", n=1008, info=NULL){
  ## if you want all Pokemon between 1 and your number of interest n
  if(pokemon=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/pokemon/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(pokemon!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/pokemon/", pokemon, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(pokemon!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/pokemon/", pokemon, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```

### `WhichBerry` endpoint 2 

This function will return a list of berries and their ID number.  If you only wanted to see the first n number of berries you would set n equal to that number. For example n=10 will return only the first 10 berries. If you have a specific berry in mind you can give the name or ID as berry="name" or berry=ID which will return a the information available about that specific berry. If you know the information that you want on that berry you can set info equal to the info of interest. For example if want the smoothness set info="smoothness".

```{r berry endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

WhichBerry <- function(berry="all", n=10, info=NULL){
  ## if you want all berries between 1 and your number of interest n
  if(berry=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/berry/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(berry!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/berry/", berry, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(berry!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/berry/", berry, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```

### `WhatGeneration` endpoint 3 

This function will return a list of generations and their ID number.  If you only wanted to see the first n number of generations you would set n equal to that number. For example n=9 will return all 9 generations. If you have a specific generation in mind you can give the name or ID as gen="name" or gen=ID which will return the information available about that specific generation. If you know the information that you want on that generation you can set info equal to the info of interest. For example if want the types of pokemon in that generations set info="types".

```{r generation endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

WhatGeneration <- function(gen="all", n=9, info=NULL){
  ## if you want all between 1 and your number of interest n
  if(gen=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/generation/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(gen!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/generation/", gen, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(gen!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/generation/", gen, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```

### `ContestTypes` endpoint 4 

This function will return a list of contest types and their ID number.  If you only wanted to see the first n number of contest types you would set n equal to that number. For example n=5 will return all contest types. If you have a specific contest in mind you can give the name or ID as con="name" or con=ID which will return the information available about that specific contest type. If you know the information that you want on that contest type you can set info equal to the info of interest. For example if want the berry flavor that correlates with this contest type set info="berry_flavor".

```{r contest-type endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

ContestTypes <- function(con="all", n=5, info=NULL){
  ## if you want all  between 1 and your number of interest n
  if(con=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/contest-type/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(con!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/contest-type/", con, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(con!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/contest-type/", con, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```


### `GotItem` endpoint 5

This function will return a list of items and their ID number.  If you only wanted to see the first n number of items you would set n equal to that number. For example n=10 will return only the first 10 items. If you have a specific item in mind you can give the name or ID as item="name" or item=ID which will return the information available about that specific item. If you know the information that you want on that item you can set info equal to the info of interest. For example if want the cost set info="cost".

```{r item endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

GotItem <- function(item="all", n=510, info=NULL){
  ## if you want all between 1 and your number of interest n
  if(item=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/item/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(item!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/item/", item, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(item!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/item/", item, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```


### `WhereAmI` endpoint 6

This function will return a list of locations and their ID number.  If you only wanted to see the first n number of locations you would set n equal to that number. For example n=10 will return only the first 10 locations. If you have a specific location in mind you can give the name or ID as loc="name" or loc=ID which will return a the information available about that specific location. If you know the information that you want on that location you can set info equal to the info of interest. For example if want the region set info="region".

```{r location endpoint, eval=TRUE, echo=TRUE}
## https://pokeapi.co/api/v2/pokemon/ 

WhereAmI <- function(loc="all", n=50, info=NULL){
  ## if you want all between 1 and your number of interest n
  if(loc=="all"){
  
 n == n
 ## creates the url to contact   
 url <- paste0("https://pokeapi.co/api/v2/location/", "?limit=", n )
    
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)

 data<- as_tibble(jsondata$results)
 ## gets rid of the url column and adds a new column containing id numbers 
 data1<- data %>% select(name) %>% mutate(ID=1:n)
 
  }
 ## this returns info available on the specific Pokemon or ID number 
  if(loc!= "all"&is.null(info)){
 ## generates url containing Pokemon name or ID of interest   
 url <- paste0("https://pokeapi.co/api/v2/location/", loc, "/" ) 
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)
 ## gives the available info on this Pokemon 
 data1<- as_tibble(names(jsondata))
 
  }
  if(loc!="all"& !is.null(info)){
  url <- paste0("https://pokeapi.co/api/v2/location/", loc, "/" ) 
  
  #"https://pokeapi.co/api/v2/pokemon/bulbasaur/
 
 response <-GET(url)
 
 data <- rawToChar(response$content)
 
 jsondata <- fromJSON(data)  
 ## gives the desired info on this Pokemon 
 data1 <- as_tibble(jsondata[[info]])
  
 
  }
  data1
}


```




### This function will use our `WhosThatPokemon` function to pull whichever pokemon are desired and return info quantitative info with a single value (height, weight, base_experience) to help with our EDA. For example say you want ID 25 - 42, or a random sample pokemon, and their heights. This function takes a vector of  names **or** a vector of ID's that are supplied by the user and info = "desired info".

```{r get a sample of pokemon, eval=TRUE, echo=TRUE}

GiveMeThesePokemon <- function(pokemons, info=NULL){
  
  ## checks if the vector input is numeric 
  if(is.numeric(pokemons)){
  
  ##creates index of all Pokemon 
  index <- WhosThatPokemon()
  
  ## adjusts the index to be the ID of interest   
  index <- subset(index, ID %in% pokemons) 
  
  ## applies the WhosThatPokemon function to ID's of interest 
  ThesePokemon <-sapply(X=pokemons, FUN = WhosThatPokemon, info = info)
  ThesePokemon <- unlist(ThesePokemon)
  
  ## creates a data frame with names 
  p<- data.frame(name=index$name, ID=index$ID , info=ThesePokemon)
  ## sets the name of the column with desired info to the info requested 
  names(p)[3] <- info
  
  return(as_tibble(p))
  }
else{
  index <- WhosThatPokemon() 
  ## adjusts the index to be name of interest   
  index <- subset(index, name %in% pokemons)

  ## applies the whos that pokemon function to ID's of interest 
  ThesePokemon <-sapply(X=pokemons, FUN = WhosThatPokemon, info = info)
  ThesePokemon <- unlist(ThesePokemon)
  
  ## creates a data frame with names 
  p<- data.frame(name=index$name, ID=index$ID , info=ThesePokemon, row.names = NULL)
  ## sets the name of the column with desired info to the info requested 
  names(p)[3] <- info
  
  return(as_tibble(p))

 }
}


```


## EDA 


### We are going to use the fuctions that we createed to get the heights and weights the pokemon and look at the relationship.  

```{r heights weights types, eval=TRUE, echo=TRUE, cache=TRUE}
## sets the tibble of first 10 pokemon as a global object 
test10<- WhosThatPokemon(n=10)

## contacts the api to get the heights for the first 10 pokemon
TenPokeHeights <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "height")

## converts the results to a tibble with the heights as the column
TenPokeHeights <- unlist(TenPokeHeights) %>% as_tibble()
names(TenPokeHeights) <- "height"


## contacts the api to get the weights for the first 10 pokemon
TenPokeWeights <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "weight")

## converts result to tibble with weights as the column
TenPokeWeights <- unlist(TenPokeWeights) %>% as_tibble()
names(TenPokeWeights) <- "weight"

## contacts the api to get the types for the first 10 pokemon 
TenPokeTypes <- sapply(X=test10$name, FUN = WhosThatPokemon, info = "types")

TenPokeTypes <- sapply(1:10, FUN = function(i){TenPokeTypes[[i]][[2]][1,1]})

TenPokeTypes<- TenPokeTypes%>% as_tibble()

names(TenPokeTypes) <- "type"

## binds the column of heights and weights to the pokemon 
PokemonHeightsWeightsTypes <- cbind(test10, TenPokeHeights, TenPokeWeights, TenPokeTypes)

```

```{r heights vs weights scatter, echo=TRUE, eval=TRUE}

g <- ggplot(PokemonHeightsWeightsTypes, aes(x=height, y=weight))

g+geom_point(aes(color=type))



```

```{r boxplot weights,  echo=TRUE, eval=TRUE}

l <- ggplot(PokemonHeightsWeightsTypes, aes(x=weight))
            
 l + geom_boxplot() 


```









 













